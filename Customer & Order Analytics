/*
Customer & Order Analytics SQL Queries
--------------------------------------

🇬🇧 English:
This file includes several SQL queries that answer common business questions about
customers, orders, and sales in January and February. Each query is preceded by
a clear explanation in English and Spanish. The dataset is not uploaded due to size,
but the queries are fully reusable.

🇪🇸 Español:
Este archivo incluye varios queries SQL que responden a preguntas de negocio comunes
sobre clientes, pedidos y ventas en enero y febrero. Cada query está precedido de
una explicación clara en inglés y en español. El dataset no se sube por su tamaño,
pero los queries son totalmente reutilizables.
*/


------------------------------------------------------------
-- 1) How many customers ordered more than 2 products at a time in February,
--    and what was the average amount spent for those customers?
--
-- 🇬🇧 This query finds all customers who ordered more than two products
-- in a single order during February. It returns both the number of unique
-- customers and the average amount they spent.
--
-- 🇪🇸 Esta consulta encuentra a todos los clientes que ordenaron más de dos
-- productos en un solo pedido durante febrero. Devuelve tanto el número de
-- clientes únicos como el gasto promedio realizado por ellos.
------------------------------------------------------------

SELECT
    COUNT(DISTINCT customers.acctnum) AS total_customers,
    AVG(febsales.price * febsales.quantity) AS avg_spent
FROM febsales
    LEFT JOIN customers
        ON customers.order_id = febsales.orderid
WHERE febsales.quantity > 2
  AND LENGTH(febsales.orderid) = 6
  AND febsales.orderid <> 'Order ID';


------------------------------------------------------------
-- 2) Which products were sold in February at 548 Lincoln St, Seattle,
--    how many of each were sold, and what was the total revenue?
--
-- 🇬🇧 This query lists all products sold at a specific location in February,
-- showing how many units of each were sold and the total revenue generated.
--
-- 🇪🇸 Esta consulta lista todos los productos vendidos en una ubicación
-- específica durante febrero, mostrando cuántas unidades de cada uno se
-- vendieron y los ingresos totales generados.
------------------------------------------------------------

SELECT
    SUM(quantity) AS total_quantity,
    product,
    SUM(quantity) * price AS revenue
FROM bit_db.febsales
WHERE location = '548 Lincoln St, Seattle, WA 98101'
GROUP BY product;


------------------------------------------------------------
-- 3) What is the total revenue for each product sold in January?
--
-- 🇬🇧 This query calculates the revenue generated by each product in January.
--
-- 🇪🇸 Esta consulta calcula los ingresos generados por cada producto en enero.
------------------------------------------------------------

SELECT
    SUM(quantity) * price AS revenue,
    product
FROM bit_db.jansales
GROUP BY product;


------------------------------------------------------------
-- 4) Which product was the cheapest one sold in January, and what was the price?
--
-- 🇬🇧 This query identifies the cheapest product sold in January
-- and returns its name along with its price.
--
-- 🇪🇸 Esta consulta identifica el producto más barato vendido en enero
-- y devuelve su nombre junto con su precio.
------------------------------------------------------------

SELECT DISTINCT
    product,
    price
FROM bit_db.jansales
ORDER BY price ASC
LIMIT 1;


------------------------------------------------------------
-- 5) Select the customer account numbers for all the orders that
--    were placed in February.
--
-- 🇬🇧 This query returns all unique customer account numbers associated
-- with valid orders placed in February.
--
-- 🇪🇸 Esta consulta devuelve todos los números de cuenta de clientes
-- asociados con pedidos válidos realizados en febrero.
------------------------------------------------------------

SELECT DISTINCT
    acctnum
FROM bit_db.customers cust
    INNER JOIN bit_db.febsales feb
        ON cust.order_id = feb.orderid
WHERE LENGTH(orderid) = 6
  AND orderid <> 'Order ID';


------------------------------------------------------------
-- 6) How many of those orders were for an iPhone?
--
-- 🇬🇧 This query counts the number of unique orders in February
-- where the product purchased was an iPhone.
--
-- 🇪🇸 Esta consulta cuenta el número de pedidos únicos de febrero
-- en los que el producto comprado fue un iPhone.
------------------------------------------------------------

SELECT
    COUNT(DISTINCT orderid) AS iphone_orders
FROM bit_db.jansales
WHERE product = 'iPhone'
  AND LENGTH(orderid) = 6
  AND orderid <> 'Order ID';


------------------------------------------------------------
-- 7) How many unique orders were placed in January?
--    (In other words, how many distinct order IDs do we have?)
--
-- 🇬🇧 This query calculates the total number of unique orders in January
-- based on distinct order IDs.
--
-- 🇪🇸 Esta consulta calcula el número total de pedidos únicos en enero
-- basándose en los IDs distintos de orden.
------------------------------------------------------------

SELECT
    COUNT(DISTINCT orderid) AS unique_orders
FROM bit_db.jansales
WHERE LENGTH(orderid) = 6
  AND orderid <> 'Order ID';
